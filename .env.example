# HippocampAI Configuration
# Copy this file to .env and configure your settings

# ==================== API Configuration ====================
API_PORT=8000

# ==================== Qdrant Vector Database ====================
QDRANT_URL=http://localhost:6333
QDRANT_PORT=6333
QDRANT_GRPC_PORT=6334
COLLECTION_FACTS=hippocampai_facts
COLLECTION_PREFS=hippocampai_prefs

# ==================== HNSW Index Tuning (Advanced) ====================
# Higher M = better recall, more memory
HNSW_M=48
# Higher ef_construction = better index quality, slower build
EF_CONSTRUCTION=256
# Higher ef_search = better recall, slower search
EF_SEARCH=128

# ==================== Embedding Model ====================
EMBED_MODEL=BAAI/bge-small-en-v1.5
EMBED_DIMENSION=384
EMBED_BATCH_SIZE=32
EMBED_QUANTIZED=false

# ==================== Reranker (Cross-Encoder) ====================
RERANKER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
RERANK_CACHE_TTL=86400

# ==================== LLM Provider Configuration ====================
# Options: ollama, openai, anthropic, groq
LLM_PROVIDER=ollama
LLM_MODEL=qwen2.5:7b-instruct

# For Ollama (local, self-hosted)
LLM_BASE_URL=http://localhost:11434

# For OpenAI (cloud)
# LLM_PROVIDER=openai
# LLM_MODEL=gpt-4o-mini
# OPENAI_API_KEY=sk-your-key-here

# For Groq (fast, cost-effective cloud inference)
# LLM_PROVIDER=groq
# LLM_MODEL=llama-3.3-70b-versatile
# GROQ_API_KEY=gsk_your-groq-api-key-here

# For Anthropic (cloud)
# LLM_PROVIDER=anthropic
# LLM_MODEL=claude-3-haiku-20240307
# ANTHROPIC_API_KEY=sk-ant-your-key-here

# Allow cloud providers (set to true if using OpenAI/Anthropic/Groq)
ALLOW_CLOUD=false

# ==================== Retrieval Parameters ====================
# Number of candidates from vector search
TOP_K_QDRANT=200
# Final number of results after reranking
TOP_K_FINAL=20
# Reciprocal rank fusion parameter
RRF_K=60

# ==================== Scoring Weights (must sum to ~1.0) ====================
# Includes WEIGHT_GRAPH and WEIGHT_FEEDBACK for graph-aware retrieval and feedback scoring
WEIGHT_SIM=0.55
WEIGHT_RERANK=0.20
WEIGHT_RECENCY=0.15
WEIGHT_IMPORTANCE=0.10

# ==================== Importance Decay Half-Lives (days) ====================
HALF_LIFE_PREFS=90
HALF_LIFE_FACTS=30
HALF_LIFE_EVENTS=14

# ==================== Background Jobs & Scheduling ====================
ENABLE_SCHEDULER=true
# Decay importance daily at 2am
DECAY_CRON=0 2 * * *
# Consolidate memories weekly on Sunday at 3am
CONSOLIDATE_CRON=0 3 * * 0
# Create snapshots hourly
SNAPSHOT_CRON=0 * * * *

# Background Tasks
ENABLE_BACKGROUND_TASKS=true
AUTO_DEDUP_ENABLED=true
AUTO_CONSOLIDATION_ENABLED=false
DEDUP_INTERVAL_HOURS=24
CONSOLIDATION_INTERVAL_HOURS=168
EXPIRATION_INTERVAL_HOURS=1

# ==================== Redis Cache ====================
REDIS_PORT=6379
REDIS_URL=redis://localhost:6379
REDIS_DB=0
REDIS_CACHE_TTL=300
REDIS_MAX_CONNECTIONS=100
REDIS_MIN_IDLE=10

# ==================== Celery Task Queue ====================
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_TASK_ACKS_LATE=true
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# Flower UI (Celery Monitoring)
FLOWER_PORT=5555
FLOWER_USER=admin
FLOWER_PASSWORD=changeme_in_production

# ==================== Monitoring ====================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme_in_production
GRAFANA_ROOT_URL=http://localhost:3000

# ==================== Security (Recommended for Production) ====================
# Enable these in production deployments
# ENABLE_AUTH=true
# JWT_SECRET=your_jwt_secret_here
# RATE_LIMIT_PER_MINUTE=60


HIPPOCAMPAI_API_KEY=example_key_do_not_use
HIPPOCAMPAI_USER_AUTH=true



# ============================================
# SLEEP PHASE / ACTIVE CONSOLIDATION
# ============================================
# Mimics hippocampal replay during sleep
# Automatically consolidates memories every night

# Enable/disable Sleep Phase consolidation
ACTIVE_CONSOLIDATION_ENABLED=true

# Dry run mode: log actions without making changes (recommended for testing)
CONSOLIDATION_DRY_RUN=false

# Schedule: Hour of day to run consolidation (0-23, UTC)
CONSOLIDATION_SCHEDULE_HOUR=3

# How many hours back to review memories
CONSOLIDATION_LOOKBACK_HOURS=24

# ============================================
# LLM CONFIGURATION FOR CONSOLIDATION
# ============================================
# LLM model to use for consolidation decisions
CONSOLIDATION_LLM_MODEL=llama-3.1-8b-instant
CONSOLIDATION_LLM_TEMPERATURE=0.3
CONSOLIDATION_BATCH_SIZE=50

# ============================================
# POLICY THRESHOLDS
# ============================================
# Minimum importance score to keep a memory (delete if below)
CONSOLIDATION_MIN_IMPORTANCE=3.0

# Minimum age (days) before a memory can be deleted
CONSOLIDATION_MIN_AGE_DAYS=7

# Never delete memories that have been accessed?
CONSOLIDATION_PROTECT_ACCESSED=true

# Archive threshold: memories below this importance get archived
CONSOLIDATION_ARCHIVE_THRESHOLD=4.0

# Archive age: archive memories older than N days
CONSOLIDATION_ARCHIVE_AGE_DAYS=30

# Promotion multiplier: multiply importance by this when promoting
CONSOLIDATION_PROMOTION_MULTIPLIER=1.3

# ============================================
# MEMORY LIMITS
# ============================================
# Maximum total memories per user
CONSOLIDATION_MAX_MEMORIES_PER_USER=10000

# Decay factor for importance scores (0.0-1.0)
CONSOLIDATION_DECAY_FACTOR=0.95

# ============================================
# PERFORMANCE & OBSERVABILITY
# ============================================
# Number of users to process concurrently
CONSOLIDATION_CONCURRENCY=10

# Timeout for LLM calls (seconds)
CONSOLIDATION_LLM_TIMEOUT=60

# Log level for consolidation
CONSOLIDATION_LOG_LEVEL=INFO

# Enable Prometheus metrics
CONSOLIDATION_METRICS_ENABLED=true

# ============================================
# REAL-TIME KNOWLEDGE GRAPH
# ============================================
ENABLE_REALTIME_GRAPH=true
GRAPH_EXTRACTION_MODE=pattern          # "pattern" or "llm"
GRAPH_PERSISTENCE_PATH=data/knowledge_graph.json
GRAPH_AUTO_SAVE_INTERVAL=300           # seconds

# ============================================
# GRAPH-AWARE RETRIEVAL
# ============================================
ENABLE_GRAPH_RETRIEVAL=false
GRAPH_RETRIEVAL_MAX_DEPTH=2
WEIGHT_GRAPH=0.0

# ============================================
# MEMORY RELEVANCE FEEDBACK
# ============================================
WEIGHT_FEEDBACK=0.1
FEEDBACK_WINDOW_DAYS=90

# ============================================
# MEMORY TRIGGERS
# ============================================
ENABLE_TRIGGERS=true
TRIGGER_WEBHOOK_TIMEOUT=10

# ============================================
# PROCEDURAL MEMORY
# ============================================
ENABLE_PROCEDURAL_MEMORY=false
PROCEDURAL_RULE_MAX_COUNT=50
HALF_LIFE_PROCEDURAL=180

# ============================================
# EMBEDDING MIGRATION
# ============================================
EMBED_MODEL_VERSION=1
